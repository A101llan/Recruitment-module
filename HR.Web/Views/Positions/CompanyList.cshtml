@model IEnumerable<HR.Web.Models.Company>
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Companies - Positions";
}

<style>
    body {
        font-size: 0.97rem;
        background: #f6faff;
        min-height: 100vh;
    }
    .company-detail-card {
        background: #fafdff;
        border-radius: 0.4rem;
        box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        border: 1.2px solid #b2d7f7;
        padding: 1.2rem;
        position: sticky;
        top: 20px;
    }
    .company-item { 
        cursor: pointer; 
        border: none;
        border-bottom: 1px solid #e6f3fb;
        background: #fafdff;
        transition: all 0.2s;
        padding: 1.2rem;
        margin-bottom: 0.5rem;
        border-radius: 0.4rem;
    }
    .company-item:hover {
        background: #eaf4fb;
    }
    .company-item.active { 
        box-shadow: 0 0 8px 2px #007bff, 0 0 0 2px #fff inset;
        border-radius: 6px;
        background: rgba(0,123,255,0.08);
        border-left: 3px solid #007bff;
        border-bottom: 1px solid #007bff;
    }
    .company-item.active h5 {
        color: #007bff !important;
        font-weight: 600;
    }
    .card-title, h4, h5 {
        color: #0d2c4a;
        font-weight: 600;
    }
    .btn-blue {
        background: #6fb8dc;
        color: #0d2c4a;
        border: none;
        transition: background 0.2s;
        font-size: 0.97rem;
        padding: 0.5rem 1.2rem;
        border-radius: 0.4rem;
        font-weight: 600;
    }
    .btn-blue:hover {
        background: #3498db;
        color: #fff;
    }
    .text-muted {
        color: #6c757d !important;
    }
</style>

<div class="mb-4">
    <h2><i class="fas fa-building text-primary"></i> Select a Company</h2>
    <p class="text-muted">Viewing companies to browse their respective job positions.</p>
</div>

@if (!Model.Any())
{
    <div class="alert alert-info">
        <i class="fas fa-info-circle"></i> No companies found in the system.
    </div>
}
else
{
    <div class="row">
        <div class="col-md-7">
            <div class="list-group">
                @foreach (var c in Model)
                {
                    <div class="list-group-item list-group-item-action company-item"
                         data-id="@c.Id"
                         data-name="@c.Name"
                         data-slug="@c.Slug"
                         data-status="@(c.IsActive ? "Active" : "Inactive")"
                         data-expiry="@(c.LicenseExpiryDate.HasValue ? c.LicenseExpiryDate.Value.ToShortDateString() : "Never")"
                         data-url="@Url.Action("Index", "Positions", new { companyId = c.Id })">
                        <div class="d-flex w-100 justify-content-between align-items-center">
                            <div class="d-flex align-items-center">
                                <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center mr-3" style="width: 40px; height: 40px; font-weight: bold;">
                                    @c.Name.Substring(0, 1).ToUpper()
                                </div>
                                <div>
                                    <h5 class="mb-0">@c.Name</h5>
                                    <small class="text-muted">Slug: @c.Slug</small>
                                </div>
                            </div>
                            <span class="badge badge-@(c.IsActive ? "success" : "danger")">
                                @(c.IsActive ? "Active" : "Inactive")
                            </span>
                        </div>
                    </div>
                }
            </div>
        </div>
        <div class="col-md-5">
            <div id="companyDetail" class="company-detail-card" style="display:none;">
                <div class="text-center mb-4">
                    <div id="compInitial" class="rounded-circle bg-primary text-white d-inline-flex align-items-center justify-content-center mb-3 shadow-sm" style="width: 70px; height: 70px; font-size: 2rem; font-weight: bold;">
                    </div>
                    <h3 id="compName" class="mb-1"></h3>
                    <p id="compSlug" class="text-muted small"></p>
                </div>
                
                <hr />
                
                <div class="mb-3">
                    <label class="text-muted small d-block mb-0">Status</label>
                    <span id="compStatus" class="font-weight-bold"></span>
                </div>
                
                <div class="mb-4">
                    <label class="text-muted small d-block mb-0">License Expiry</label>
                    <span id="compExpiry" class="font-weight-bold"></span>
                </div>
                
                <div class="alert alert-info py-2 small mb-4">
                    <i class="fas fa-info-circle"></i> Selecting this company will allow you to view their job positions in <strong>read-only</strong> mode.
                </div>
                
                <a id="btnViewPositions" href="#" class="btn btn-blue btn-block btn-lg">
                    <i class="fas fa-search mr-2"></i> View Job Positions
                </a>
            </div>
            
            <div id="noSelection" class="company-detail-card text-center py-5">
                <i class="fas fa-arrow-left fa-3x text-muted mb-3 opacity-50"></i>
                <h5 class="text-muted">Select a company from the list to view details</h5>
            </div>
        </div>
    </div>
}

@section Scripts {
    <script>
        $(document).ready(function () {
            var items = $('.company-item');
            var detail = $('#companyDetail');
            var noSelection = $('#noSelection');
            
            items.on('click', function () {
                var el = $(this);
                
                // Active state
                items.removeClass('active');
                el.addClass('active');
                
                // Update detail
                $('#compName').text(el.data('name'));
                $('#compSlug').text('Slug: ' + el.data('slug'));
                $('#compStatus').text(el.data('status')).removeClass('text-success text-danger')
                    .addClass(el.data('status') === 'Active' ? 'text-success' : 'text-danger');
                $('#compExpiry').text(el.data('expiry'));
                $('#compInitial').text(el.data('name').charAt(0).toUpperCase());
                $('#btnViewPositions').attr('href', el.data('url'));
                
                // Show detail
                noSelection.hide();
                detail.fadeIn(200);
            });
        });
    </script>
}
