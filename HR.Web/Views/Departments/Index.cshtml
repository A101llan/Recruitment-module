@model IEnumerable<HR.Web.Models.Department>
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Departments";
}
@if (User != null && User.Identity != null && (User.IsInRole("Admin") || User.IsInRole("HR")))
{
    <a class="btn btn-primary mb-2" href="@Url.Action("Create")">New Department</a>
}
<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Name</th>
            <th>Overview</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
    @foreach (var item in Model)
    {
        <tr>
            <td>@item.Name</td>
            <td>
                @if (item.Positions != null && item.Positions.Any())
                {
                    <span>@item.Positions.Count() position(s): @string.Join(", ", item.Positions.Select(p => p.Title))</span>
                }
                else
                {
                    <span>No positions in this department.</span>
                }
            </td>
            <td>
                @if (User != null && User.Identity != null && (User.IsInRole("Admin") || User.IsInRole("HR")))
                {
                    @Html.ActionLink("Details","Details", new { id=item.Id }, new { @class="btn btn-sm btn-info"}) @:|
                    @Html.ActionLink("Edit","Edit", new { id=item.Id }, new { @class="btn btn-sm btn-secondary"}) @:|
                    @Html.ActionLink("Delete","Delete", new { id=item.Id }, new { @class="btn btn-sm btn-danger"})
                }
            </td>
        </tr>
    }
    </tbody>
</table>


