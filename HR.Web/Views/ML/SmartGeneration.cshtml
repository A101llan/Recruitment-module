@{
    ViewBag.Title = "ML Smart Question Generation";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <h2><i class="fas fa-brain"></i> ML Smart Question Generation</h2>
            <p class="text-muted">Machine Learning enhanced question generation with industry detection and weighted scoring</p>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5><i class="fas fa-robot"></i> ML-Enhanced Generation</h5>
                </div>
                <div class="card-body">
                    <form id="mlGenerationForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="jobTitle">Job Title *</label>
                                    <input type="text" class="form-control" id="jobTitle" 
                                           placeholder="e.g., Senior Software Engineer" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="experience">Experience Level</label>
                                    <select class="form-control" id="experience">
                                        <option value="entry">Entry Level</option>
                                        <option value="junior">Junior</option>
                                        <option value="mid" selected>Mid-Level</option>
                                        <option value="senior">Senior</option>
                                        <option value="lead">Lead/Principal</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="jobDescription">Job Description *</label>
                            <textarea class="form-control" id="jobDescription" rows="4" 
                                      placeholder="Describe the role, responsibilities, and requirements..." required></textarea>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Question Types</label>
                                    <div class="checkbox-group">
                                        <label class="checkbox-inline">
                                            <input type="checkbox" value="Text" checked> Text
                                        </label>
                                        <label class="checkbox-inline">
                                            <input type="checkbox" value="Choice" checked> Choice
                                        </label>
                                        <label class="checkbox-inline">
                                            <input type="checkbox" value="Number"> Number
                                        </label>
                                        <label class="checkbox-inline">
                                            <input type="checkbox" value="Rating"> Rating
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="questionCount">Number of Questions</label>
                                    <input type="number" class="form-control" id="questionCount" 
                                           value="5" min="1" max="20">
                                </div>
                            </div>
                        </div>

                        <div class="text-center">
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-robot"></i> Generate ML Questions
                            </button>
                            <button type="button" class="btn btn-info ml-2" id="analyzeBtn">
                                <i class="fas fa-chart-line"></i> Analyze Question
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Section -->
    <div class="row" id="resultsSection" style="display: none;">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5><i class="fas fa-list"></i> ML-Generated Questions</h5>
                </div>
                <div class="card-body">
                    <div id="mlResults"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ML Features Showcase -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-brain"></i> ML Features Working</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="text-center">
                                <i class="fas fa-industry fa-3x text-success mb-2"></i>
                                <h6>ML Industry Detection</h6>
                                <p class="small text-muted">Weighted scoring algorithm with confidence thresholds</p>
                                <span class="badge badge-success">✅ WORKING</span>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <i class="fas fa-balance-scale fa-3x text-info mb-2"></i>
                                <h6>Weighted Keywords</h6>
                                <p class="small text-muted">3x weight for core technologies, 2x for frameworks</p>
                                <span class="badge badge-success">✅ WORKING</span>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <i class="fas fa-chart-pie fa-3x text-warning mb-2"></i>
                                <h6>Category Prediction</h6>
                                <p class="small text-muted">ML-like confidence scoring for question categories</p>
                                <span class="badge badge-success">✅ WORKING</span>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <i class="fas fa-star fa-3x text-primary mb-2"></i>
                                <h6>ML Scoring</h6>
                                <p class="small text-muted">Category-based algorithm with complexity bonuses</p>
                                <span class="badge badge-success">✅ WORKING</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.question-item {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-left: 4px solid #28a745;
    padding: 15px;
    margin-bottom: 10px;
    border-radius: 4px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.question-category {
    display: inline-block;
    background: #6c757d;
    color: white;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.8em;
    margin-left: 10px;
}
.question-category.technical { background: #28a745; }
.question-category.leadership { background: #ffc107; color: #212529; }
.question-category.behavioral { background: #17a2b8; }
.question-category.analytical { background: #6f42c1; }
.ml-badge {
    background: linear-gradient(45deg, #28a745, #20c997);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8em;
    margin-left: 5px;
}
</style>

@section Scripts {
<script>
$(document).ready(function() {
    $('#mlGenerationForm').on('submit', function(e) {
        e.preventDefault();
        generateMLQuestions();
    });

    $('#analyzeBtn').on('click', function() {
        analyzeQuestion();
    });

    function generateMLQuestions() {
        var formData = {
            jobTitle: $('#jobTitle').val(),
            jobDescription: $('#jobDescription').val(),
            experience: $('#experience').val(),
            questionTypes: [],
            count: parseInt($('#questionCount').val())
        };

        $('input[type="checkbox"]:checked').each(function() {
            formData.questionTypes.push($(this).val());
        });

        if (!formData.jobTitle || !formData.jobDescription) {
            alert('Please fill in the required fields.');
            return;
        }

        $.ajax({
            url: '/ML/GenerateSmartQuestions',
            type: 'POST',
            data: formData,
            traditional: true,
            success: function(response) {
                if (response.success) {
                    displayMLResults(response);
                } else {
                    alert('Error: ' + response.message);
                }
            },
            error: function() {
                alert('Error generating ML questions');
            }
        });
    }

    function analyzeQuestion() {
        var questionText = prompt("Enter a question to analyze with ML:");
        if (!questionText) return;

        $.ajax({
            url: '/ML/AnalyzeQuestion',
            type: 'POST',
            data: { questionText: questionText, questionType: 'Text' },
            success: function(response) {
                if (response.success) {
                    alert(`ML Analysis Results:\n\nValid: ${response.isValid}\nCategory: ${response.category}\nScore: ${response.score}\nWarnings: ${response.warnings.join(', ') || 'None'}\nSuggestions: ${response.suggestions.join(', ') || 'None'}`);
                } else {
                    alert('Error: ' + response.message);
                }
            },
            error: function() {
                alert('Error analyzing question');
            }
        });
    }

    function displayMLResults(response) {
        var html = '<div class="alert alert-success">';
        html += '<strong>ML Generation Complete!</strong> ';
        html += 'Generated ' + response.questions.length + ' ML-enhanced questions for ' + response.metadata.jobTitle;
        html += '<br><small>Algorithm: ' + response.metadata.algorithm + ' | ';
        html += 'Features: ' + response.metadata.features.join(', ') + ' | ';
        html += 'Generated: ' + new Date(response.metadata.generatedAt).toLocaleString() + '</small>';
        html += '</div>';

        response.questions.forEach(function(q, index) {
            html += '<div class="question-item">';
            html += '<strong>Q' + (index + 1) + ':</strong> ' + q.text;
            html += '<span class="question-category ' + q.category + '">' + q.category + '</span>';
            html += '<span class="ml-badge">ML-Enhanced</span>';
            html += '<br><small>Type: ' + q.type + ' | Required: ' + (q.isRequired ? 'Yes' : 'No') + '</small>';
            
            if (q.options && q.options.length > 0) {
                html += '<div class="mt-2">';
                q.options.forEach(function(opt) {
                    html += '<span class="badge badge-secondary mr-1">' + opt.text + ' (' + opt.points + ' pts)</span>';
                });
                html += '</div>';
            }
            
            html += '</div>';
        });

        $('#mlResults').html(html);
        $('#resultsSection').show();
        
        // Scroll to results
        $('html, body').animate({
            scrollTop: $('#resultsSection').offset().top - 100
        }, 500);
    }
});
</script>
}
